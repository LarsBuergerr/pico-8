pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--main class

function _init()

	map_init()
	player_init()
end

function _update()
	player_update()
end

function _draw()
	cls()
	map_draw()
	player_draw()
end
-->8
--player class

function player_init()	
	player = {
 gravity = 1,
	x       = 64,
	y       = 0,
	dx 					= 0,
	dy						= 0,
	w							= 8,
	h							= 8,
	sprite  = 0,
	swap    = false,
	gravity = 0.3,
	boost   = 4,
	landed  = false,
	falling	= true,
	jumping = false,
	running = false,
	anim				= 0, 
	}
end

function player_update()

	player.dy += player.gravity

	if (btn(➡️)) then
	 player.dx += 1.5
	 player.swap = true
	end
	
	if (btn(⬅️)) then
	 player.dx -= 1.5
	 player.swap = false
	end

	if (btnp(4)) and
	 player.landed then
		player.dy-=player.boost
		player.landed=false
	end
	
	if player.dy > 0 then
		player.falling=true
		player.landed=false
		player.jumping=false
		player.running=false
		
		if collision(player, "down", 0) then
			player.falling=false
			player.landed=true
			player.jumping=false
			player.dy=0
			player.y -= (player.y+player.h)%8
		end
	elseif player.dy<0 then
		player.jumping=true
		player.falling=false
		player.landed=false
		player.running=false
		if collision(player,"up",0) then
			player.dy=0
		end
	end
	
	if player.dx<0 then
		player.running = true

		if collision(player, "left", 0) then			player.dx = 0
			player.dx=0
		end
	elseif player.dx>0 then
		player.running = true

		if collision(player, "right", 0) then
			player.dx=0
		end
	end
	
	player.x += player.dx
	player.y += player.dy
	
	player.dx = 0
	
	set_animation()
end

function player_draw()
	print(player.landed)
	print(player.falling)
	print(player.running)
	print(player.jumping)
	print(player.sprite)
	print(player.dy)
	spr(player.sprite, player.x, player.y, 1, 2, player.swap)
end


function collision(obj, aim, flag)
 local x=obj.x  local y=obj.y
 local w=obj.w		local h=obj.h
 
 local x1=0		local y1=0
 local x2=0 	local y2=0
 
 if aim=="left" then
 	x1=x-1			y1=y
 	x2=x					y2=y+h-1
 	
 elseif aim=="right" then
 	x1=x+w			y1=y
 	x2=x+w+1	y2=y+h-1
 	
 elseif aim=="up" then
 	x1=x+1			y1=y-1
 	x2=x+w-2	y2=y
 	
 elseif aim=="down" then
 	x1=x+1					y1=y+h
 	x2=x+w-2			y2=y+h
 end
 
 x1/=8		y1/=8
 x2/=8		y2/=8
 
 if fget(mget(x1, y1), flag)
 or fget(mget(x1, y2), flag)
 or fget(mget(x2, y1), flag)
 or fget(mget(x2, y2), flag) then
		return true
	else
		return false
	end
end


function set_animation()

	if player.jumping then
		player.sprite = 2
	
	elseif player.falling then
		player.sprite = 3

	elseif player.running then
	 if time() - player.anim>.1 then
	 	player.anim = time()
	 	
	 	player.sprite += 1

			if player.sprite > 7 or
					 player.sprite < 4 then
				player.sprite = 4
			end
		end

	elseif player.landed then

		if time() - player.anim>.3 then
			player.anim = time()
			player.sprite+=1
			
			if player.sprite > 1 then
				player.sprite = 0
			end
		end
	end
end
-->8
--map class

function map_init()
	floor = 0
	wall  = 1
end

function map_update()
	return
end

function map_draw()
	map(0, 0,0, 0, 128, 128)
end
__gfx__
0f000f000f000f0000f000f000f000f0000f0000000f0000000f0000000f00000000000000000000000000000000000000000000000000000000000000000000
0882ff000882ff0000882ff000882ff088ff000088ff000088ff000088ff00000000000000000000000000000000000000000000000000000000000000000000
0a8a20000a8a200000a8a20080a8a208a8800000a8800000a8800000a88000000000000000000000000000000000000000000000000000000000000000000000
00080000005850000885852008858520008500000080000000850000008000000000000000000000000000000000000000000000000000000000000000000000
00555000080508008000500200005000855020000052000025508000005800000000000000000000000000000000000000000000000000000000000000000000
08050200000500000088520000008000005000000850000000500000025000000000000000000000000000000000000000000000000000000000000000000000
00802000008020000080002000080200020880000028000008022000008200000000000000000000000000000000000000000000000000000000000000000000
00802000008020000000000000802000020000000028000008000000008200000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777776000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000200000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000200000000000000000002020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000200000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000202000002020202020200020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020200000000000000000000000200020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202000002020202000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020202000002020202020202000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
